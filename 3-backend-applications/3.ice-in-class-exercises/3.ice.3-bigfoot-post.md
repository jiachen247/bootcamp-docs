# 3.ICE.3: Bigfoot POST

## Introduction

Use forms and POST requests to save new Bigfoot sightings to our DB.

## Base

Enable our users to save Bigfoot sightings to our DB. Work in the following order.

### Create New Sighting Form

1. Create a new sighting form that sends a POST request to the server when users submit new sightings.
2. Start with just YEAR and SEASON fields so we don't overwhelm ourselves.
3. Confirm that the form produces requests with the appropriate data by inspecting the request in Chrome DevTools.

### Create Test Requests using Curl and Postman

1. Often we will want to test our server logic by sending requests independent of our frontends. This is so that we don't have to fill out forms and click several buttons every time we wish to send the same request.
2. We will learn 2 ways to send requests outside of our frontends: Curl and Postman.

#### Curl

1. Curl is a command line utility for sending requests.
2. Send a POST request for new Bigfoot sightings using `curl` like the example below. `-d` is for `--data`, and `-X` is for `--request`, allowing us to specify a custom request method different from the default GET method.

   ```text
   curl -d "YEAR=1989&SEASON=spring" -X POST http://localhost:3004/sighting
   ```

#### Postman

1. If you haven't already, install Postman from [0.7: Postman](../../0-language-and-tooling/0.7-postman.md).
2. Use Postman to create requests and test server responses with a visual interface.

### Add Server Route to Handle Request

Create the listener for the request. Remember to include the configuration for [request.body](../3.1-express-js/3.1.3-handling-post-requests.md#keys-and-values). Begin with just a `console.log` to confirm that you are receiving the request correctly:

```javascript
console.log(request.body);
response.send('it worked!');
```

Run the above `curl` command to confirm that the request is received properly.

Run the command again with different parameters to see them in request.body:

```text
curl -d "YEAR=9999999&SEASON=pepper" -X POST http://localhost:3004/sighting
```

### Save Sighting Data to JSON

Use the `jsonFileStorage` `add` function to store the request.

## Comfortable

### Add Full Sighting Parameters

Add the rest of the params to the form.

### Redirect After Form Submit

The normal behavior for an app when the request was saved, is to show the current thing \(the sighting\). The easiest way we can do that is to **redirect** the user to the correct page:

```markup
http://localhost:3004/sighting/<INDEX>
```

Take a look at the Express.js docs for redirect here: [https://expressjs.com/en/api.html\#res.redirect](https://expressjs.com/en/api.html#res.redirect). Note that `res.send` and `res.redirect` are mutually exclusive, because [both terminate the request-response cycle](https://stackoverflow.com/questions/48813930/res-send-after-res-redirect-in-nodejs).

## More Comfortable

### Add Sort Form for Sightings List

Create a form that duplicates the query parameter request from the [previous sort exercise.](3.ice.1-bigfoot.md#sort-by)

Create a form that produces this request:

```text
http://localhost:3004/year-sightings?sort=asc
http://localhost:3004/year-sightings?sort=desc
```

Remember that by default, a form produces a GET request with query parameters.

Use an HTML `select` tag in the form that allows the user to select the sort parameter \(in this case, `asc` and `desc`\) from the dropdown.

You can also add a similar dropdown for [the other sort option:](3.ice.2-bigfoot-ejs.md#sort-by)

```markup
http://localhost:3004/?sortBy=year
http://localhost:3004/?sortBy=state
```

