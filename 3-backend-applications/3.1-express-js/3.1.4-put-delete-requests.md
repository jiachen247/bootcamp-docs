# 3.1.4: PUT, DELETE Requests

## Introduction

GET, POST, PUT, and DELETE are 4 of the most common HTTP methods on the Internet, corresponding to 4 core operations of most apps today: Create \(POST\), Retrieve \(GET\), Update \(PUT\), and Delete \(DELETE\), aka "CRUD". Most apps primarily consist of CRUD functionality, in contrast to apps that might involve more advanced technologies such as blockchain or machine learning.

Let's learn how to use PUT and DELETE requests in our apps.

## PUT Requests

Let's use PUT requests to edit data we've already stored in our app. For data deletion, we will use DELETE requests as described in the DELETE section below.

### Express Routing Method

1. `app.put` works very similarly to `app.get` and `app.post`, accepting URL path and. callback params.

   ```javascript
   app.put(<PATH>, <CALLBACK>);
   ```

2. The URL paths for PUT requests at RA typically include a path parameter that specifies the resource to edit, for example with an index value. We need this parameter to determine which data to edit.
3. In the below example we replace all data at the specified location with data from the request. We could also append request data to data at the specified location if we wanted.

   ```javascript
   app.put('/recipe/:index', function (request, response) {
     const { index } = request.params;
     read('data.json', (err, data) => {
       // Replace the data in the object at the given index
       data['recipes'][index] = request.body;
       write('data.json', data, (err) => {
         response.send('Done!');
       });
     });
   });
   ```

4. Send a test PUT request with Curl or Postman.

   ```markup
   curl -X PUT -d fruit=apple localhost:3004/recipe/1
   ```

5. Verify we updated the relevant recipe in `data.json`.

### Method Override

For some unclear reason, browsers are not able to produce a request with method PUT. We still want to be able to write `app.put` in express so we can use library so that if we pass a special query param, Express.js will still call the correct callback.

Install the package:

```markup
npm install method-override
```

Put the configs in the `index.js` file:

```javascript
import methodOverride from 'method-override';

// override with POST having ?_method=PUT
app.use(methodOverride('_method'));
```

Add a query parameter to the end of the action:

Add a hidden form field param to pass into the package. It is watching for incoming requests with this param.

```markup
/recipe/1?_method=PUT
```

See more about method-override here:

* [https://dev.to/moz5691/method-override-for-put-and-delete-in-html-3fp2\#:~:text=Browsers](https://dev.to/moz5691/method-override-for-put-and-delete-in-html-3fp2#:~:text=Browsers)
* [http://expressjs.com/en/resources/middleware/method-override.html](http://expressjs.com/en/resources/middleware/method-override.html)
* [https://softwareengineering.stackexchange.com/questions/114156/why-are-there-are-no-put-and-delete-methods-on-html-forms](https://softwareengineering.stackexchange.com/questions/114156/why-are-there-are-no-put-and-delete-methods-on-html-forms)

### PUT Form

We need a GET route to render the form that will create the request to our route above.

```javascript
app.get('/putform', (request, response) => {
  response.render('edit');
});
```

#### edit.ejs

```markup
<html>
  <body>
    <form action="/recipe/<%= recipe.index %>?_method=PUT" method="POST">
      <label for="label">recipe label:</label><br />
      <input type="text" id="label" name="label" /><br />
      <label for="ingredients">ingredients:</label><br />
      <input type="text" id="ingredients" name="ingredients" /><br />
      <input type="submit" value="Submit" />
    </form>
  </body>
</html>
```

{% hint style="info" %}
Note that we use `method="POST"` in our form tag even though we want the form to send a PUT request. This is because HTML forms currently do not support PUT and DELETE requests natively. More info [here](https://softwareengineering.stackexchange.com/questions/114156/why-are-there-are-no-put-and-delete-methods-on-html-forms).
{% endhint %}

### Previous Data

After making the route work, one specific optimization we need to make to the system is to, before the user submits new information, show them the old / current data.

This means we need to render a form that already has the current info in it.

The path shown below is the proper edit URL path.

```javascript
app.get('/recipe/:index/edit', (request, response) => {
  // Retrieve current recipe data and render it
  read('data.json', (err, data) => {
    const { index } = request.params;
    const recipe = data.recipes[index];
    recipe.index = index;
    const data = { recipe };
    response.render('edit', recipe);
  });
});
```

#### edit.ejs

We use EJS to pre-populate our form with the current recipe data. On lines 2 and 8 we set the value of the form to the data we passed inside the route.

```markup
<label for="label">recipe label:</label><br />
<input type="text" id="label" name="label" value="<%= recipe.label %>" /><br />
<label for="ingredients">ingredients:</label><br />
<input
  type="text"
  id="ingredients"
  name="ingredients"
  value="<%= recipe.ingredients %>"
/>
```

## PUT Request Flow

![](../../.gitbook/assets/put.jpg)

This series of requests needs to happen in 2 stages.

#### **Render the form.**

1\) The browser makes a GET request to render the form. The request passes the index of the recipe it wants to edit. Express looks in the JSON file to find the recipe and populates the values into the form, and sends it back.

2\) The form, with that recipe's current values are rendered into the browser.

#### **Submit the form.**

Note that we also made this request with `curl` above.

3\) The user clicks the submit button of the form. It goes to `/recipe/2`. The place where the request goes to has already been set by the HTML- the `action` attribute of the form. We already knew how to set the action in **2** given the index parameter from **1**.

4\) The response is sent back to the browser. A typical response would be a redirect to `/recipe/2`. Not shown is the other GET request that would produce.

## DELETE

Delete does exactly what it says- it takes an element out of the array. We are using `splice` for this.

```javascript
app.delete('/recipe/:index', (request, response) => {
  // Remove element from DB at given index
  const { index } = request.params;
  read('data.json', (err, data) => {
    data['recipes'].splice(index, 1);
    write('data.json', data, (err) => {
      response.send('Done!');
    });
  });
});
```

#### DELETE Form

We don't need any information to do a DELETE, only the index of the thing we want to delete. For this reason, DELETE forms don't often merit their own separate form pages. This form would normally go somewhere that is related to this recipe, like `/` or `/recipe/:index`.

#### delete.ejs

```markup
<form action="/recipe/<%= index %>?_method=DELETE" method="POST">
  <input type="submit" value="Submit" />
</form>
```

