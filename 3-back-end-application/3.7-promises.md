# 3.7: Promises

Promises are a tool in JavaScript to write code that is not a deeply nested set of callback functions.

Unlike many other modules we're first going to describe using promises with .then, the most common way you'll see promises, and then we'll see some of the details of writing them yourself.

## Axios

[Axios](https://www.npmjs.com/package/axios) is a promise based HTTP library.

Install it:

```text
npm install axios
```

Run some code that gets some JSON data:

```text
import axios from 'axios';
 
// Make a request
axios.get('http://dog.ceo/api/breeds/image/random')
  .then((response) => {
    // handle success
    console.log(response);
  });
```

### .then

This syntax above is calling the function `then` on the return value of get:

```text
// Make a request
const getPromise = axios.get('http://dog.ceo/api/breeds/image/random');

const whenRequestHasResponse = (response) =>{
    // handle success
    console.log(response);
};

getPromise.then(whenRequestHasResponse);
```

One of the main features of the Promise syntax is that the functions involved _must_ return a promise.

### Sequential

One of the worst parts of JavaScript callbacks is the fact that if you want four things to happen in order,  you have to nest them. They become unreadable when you have many things inside of other things.

With promises you can keep everything to mostly one level of nesting.

A series of three sequential requests:

```javascript
axios
  .get('https://maps.googleapis.com/maps/api/geocode/json?&address=' + this.props.p1)
  .then(response => {
    return axios.get('https://maps.googleapis.com/maps/api/geocode/json?&address=' + this.props.p2);
  })
  .then(response => {
    return axios.get('https://maps.googleapis.com/maps/api/geocode/json?&address=' + this.props.p3);
  })
  .then(response => {
    console.log( response );
  });
```

## Write your own

It's much more rare to write your own promises unless you are building your own library, but knowing some of the mechanics can be helpful.

### resolve

Promises give a way inside a callback to trigger the `then` callback in another place.

We call resolve when the timeout is finished and it kicks off the callback in the `then`. 

```javascript
console.log('creating promise');
const myFirstPromise = new Promise((resolve, reject) => {
  // We call resolve(...) when what we were doing asynchronously was successful, and reject(...) when it failed.
  // In this example, we use setTimeout(...) to simulate async code. 
  // In reality, you will probably be using something like AJAX.
  console.log('setting timeout');
  setTimeout( () => {
    console.log('timeout done, calling resolve');
    resolve("Success!")  // Yay! Everything went well!
    console.log('done calling resolve');
  }, 250);
  console.log('done setting timeout');
});

console.log('about to set then callback');
myFirstPromise.then((successMessage) => {
  // successMessage is whatever we passed in the resolve(...) function above.
  // It doesn't have to be a string, but if it is only a succeed message, it probably will be.
  console.log("Yay! " + successMessage);
  console.log('done calling then');
});
console.log('done setting then callback');
```

