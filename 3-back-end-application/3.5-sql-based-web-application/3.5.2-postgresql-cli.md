# 3.5.2: PostgreSQL Node Apps

Now we'll write a command line app that mirrors the todo app we built in [2.PCE.6](../../2-back-end-basics/2.pce-post-class-exercises/2.pce.6-todo-list-json.md).

Begin by cloning the [base node app.](https://github.com/rocketacademy/base-node-swe1)

We need to install the Postgres client library for node,[ pg](https://www.npmjs.com/package/pg).

```text
npm install pg
```

## DB Queries in index.js

### SELECT

Make a simple query to the database.

{% hint style="warning" %}
Our applications will not deal with setting up the database or the tables. This code assumes that is already done.
{% endhint %}

When this code runs, what does it do?

```javascript
import pg from 'pg';

// set the way we will connect to the server
const pgConnectionConfigs = {
  user: '<MY_UNIX_USERNAME>',
  host: 'localhost',
  database: '<MY_UNIX_USERNAME>',
  port: 5432,
};

// create the var we'll use
const client = new pg.Client(pgConnectionConfigs);

// make the connection
client.connect();

// create the query done callback
const whenQueryDone = (error, result) => {
  // this error is anything that goes wrong with the query
  if (error) {
    console.log('error', error);
  } else {
    // rows key has the data
    console.log(result.rows);
  }

  // close the connection
  client.end();
};

// write the SQL query
const sqlQuery = 'SELECT * from animals';

// run the SQL query
client.query(sqlQuery, whenQueryDone);
```

### INSERT

Replace the SQL query in `index.js` with the following. What does this do?

```javascript
const sqlQuery =
  "INSERT INTO users(name, email) VALUES('brianc', 'brian.m.carlson@gmail.com')";
```

### INSERT with value params

We can give structured data to the query. The syntax is slightly different.

Confusingly, SQL syntax here uses an array to pass in the data: `['brianc', 'brian.m.carlson@gmail.com']` then references those array values in the query, `INSERT INTO users(name, email) VALUES($1, $2)` but the value `$1` references array index `0`.

```javascript
const sqlQuery = 'INSERT INTO users(name, email) VALUES($1, $2)';

const inputData = ['brianc', 'brian.m.carlson@gmail.com'];

client.query(sqlQuery, inputData, whenQueryDone);
```

## Naming

Database names should match the repo name, and be lowercase with snake\_case. 

Table names are pluralized lowercase and snake\_case.

Column names are singular lowercase and snake\_case.

## Exercise

Use the [create table example](3.5.1-postgresql.md#create-table) from the previous section [3.5.1](3.5.1-postgresql.md) to create a new table, `dogs`.

Create a command line app that records a new dog:

```javascript
node index.js fluffy terrier 654
```

This command runs an INSERT query on the database.

Check your work by looking in the database using `psql` and querying using SQL commands.

Create a command line app that gets all dogs:

```javascript
node index.js all-dogs
```

