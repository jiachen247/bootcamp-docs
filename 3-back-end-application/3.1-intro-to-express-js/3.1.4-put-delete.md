# 3.1.4: PUT/DELETE

## PUT

The next thing to add to add to our app is the ability to edit the data that's already there.

There are two specific HTTP methods for this, PUT and DELETE. DELETE is straightforward, PUT signifies a request to edit something.

```javascript
app.put('/recipe/:index' ...
```

The route for PUT is distinct because we have added the `index` request parameter. -This follows because if we want to edit something, we need to specify in the request _which_ thing to edit.

```javascript
app.put('/recipe/:index', function (request, response) {

  const { index } = request.params;
  
  read('data.json', (data) => {
  
    // completely replace the obj here
    data['recipes'][index] = request.body;
  
    write('data.json', data, (doneData) => {
      response.send('done!')
    });
  });
});
```

When we receive the request we will simply replace all of the data that's currently saved for that recipe and replace it with what's in the request.

### Method Override

For some unclear reason, browsers are not able to produce a request with method PUT. We still want to be able to write app.put in express so we can use library so that if we pass a special param,  Express.js will still call the correct callback.

Install the package:

```javascript
npm install method-override
```

Put the configs in the `index.js` file:

```javascript
import methodOverride from 'method-override';

// override with POST having ?_method=PUT
app.use(methodOverride('_method'))

```

Add a hidden form field param to pass into the package. It is watching for incoming requests with this param. 

```markup
<input type="hidden" name="_method" value="PUT">
```

See more about method-override here:

[https://dev.to/moz5691/method-override-for-put-and-delete-in-html-3fp2](https://dev.to/moz5691/method-override-for-put-and-delete-in-html-3fp2#:~:text=Browsers%20do%20support%20PUT%20and,supported%20by%20'HTML%20form'.)

[http://expressjs.com/en/resources/middleware/method-override.html](http://expressjs.com/en/resources/middleware/method-override.html)

### PUT Form

After making the route work, one specific optimization we need to make to the system is to, before the user submits new information, show them the old / current data.

This means we need to render a form that already has the current info in it.

```javascript
app.put('/recipe/:index/edit', (request, response) => {
  console.log('request came in');

  // read the JSON file
  read('data.json', (data) => {
  
    console.log('done with reading');
    
    // get the index param
    const { index } = request.params;
    
    // get out the recipe
    const recipe = data.recipes[index];
    recipe.index = index;
    const data = { recipe };
    
    // render the form, pass in the recipe
    response.render('edit', recipe);
  });
});;
```

#### edit.ejs

We use EJS to pre-populate our form with the current recipe data.

```markup
<html>
  <body>
    <form action="/recipe<%= recipe.index %>" method="POST">
        <input type="hidden" name="_method" value="PUT">
        <label for="label">recipe label:</label><br>
        <input type="text" id="label" name="label" value="<%= recipe.label %>"><br>
        <label for="ingredients">ingredients:</label><br>
        <input type="text" id="ingredients" name="ingredients" value="<%= recipe.ingredients %>"><br>
        <input type="submit" value="Submit">
    </form> 
  </body>
</html>
```

## DELETE

Delete does exactly what it says- it takes an element out of the array. We are using `splice` for this.

```javascript
app.delete('/recipe/:index', (request, response) => {
  const { index } = request.params;
  
  read('data.json', (data) => {
  
    // take a thing out of the array
    data['recipes'].splice(index, 1);
  
    write('data.json', data, (doneData) => {
      response.send('done!')
    });
  });
});
```

#### DELETE Form

We don't need any information to do a DELETE, only the index of the thing we want to delete. For this reason, DELETE forms don't often merit their own separate form pages. This form would normally go somewhere that is related to this recipe, like `/` or `/recipe/:index`.

#### delete.ejs

```markup
<form action="/recipe<%= index %>" method="DELETE">
    <input type="hidden" name="_method" value="DELETE">
    <input type="submit" value="Submit">
</form> 
```



