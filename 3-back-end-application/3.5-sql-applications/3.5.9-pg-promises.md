# 3.5.9: pg Promises

Instead of using nested callbacks for our database queries we can use promises.

## SELECT

```javascript
client
  .query('SELECT * from cats')
  .then(result => console.log(result.rows[0]))
  .catch(error => console.log(error.stack));
```

## INSERT

```javascript
const values = ['Fluffy'];

client
  .query('INSERT INTO cats (name) VALUES ($1) RETURNING *', values)
  .then(result => {
    console.log(result.rows[0]);
  })
  .catch(error => console.log(error.stack));
```

## Nested SELECT

We can get all recipies in a category based on a category by first doing a query for the category id based on the name, then joining the `recipe_categories` table with the `recipes` table.\

The result of the `categories` table query is used in the new query on line 13.

```javascript
const categoryName = 'vegan'; // from request.query
const values = [categoryName];

client
  .query('SELECT * from categories WHERE name=$1', values)
  .then(result => {
    
    console.log(result.rows[0]);
    
    // TODO: check if result.rows contains a row
    const categoryId = result.rows[0].id;
    
    const values = [categoryId];
    
    return client.query(`SELECT recipes.id, recipes.label, recipes.category_id AS recipe_category_id, categories.id AS category_id, categories.name AS category_name
      FROM recipes
      INNER JOIN categories
      ON categories.id = recipes.category_id
      WHERE category_id=$1`, values);
  })
  .then(result => {
    console.log( `all recipes with category ${categoryName}`);
    console.log( result.rows );
  })
  .catch(error => console.log(error.stack));
```

