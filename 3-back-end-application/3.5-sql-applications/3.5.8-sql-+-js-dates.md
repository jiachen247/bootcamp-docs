# 3.5.8: SQL + JS Dates

The Postgres database system has several different data types for keeping track of time data. For the purposes of the module we'll discuss some best practices for dealing with this data.

See the full docs on [these types here.](https://www.postgresql.org/docs/current/datatype-datetime.html)

## `created_at`

Most of your tables should have a column called created\_at. This is a timestamp that shows when this row was created.

This is easy to set as a column in your table:

```sql
CREATE TABLE recipes (
    id            SERIAL PRIMARY KEY,
    label         TEXT,
    created_at    TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

When you create a new row in this table, a timestamp of when you inserted the record will be set:

```sql
INSERT INTO recipes (label) VALUES ('Udon');
```

When you get the record you'll see the `created_at` value is set automatically.

```sql
SELECT * FROM recipes;
```

### TIMESTAMPTZ

The Postgres data type with the most information in it is TIMESTAMPTZ. As a best practice we should set the database column to this specific type. The value put in the database is set to the date and timezone _**at the computer that it's running on.**_

If your app never deals with saving and displaying data in different timezones then you may never need this data, but it doesn't cause any problems to record it. If the scope of your app expands later, it would be impossible to capture or properly deal with this data.

The author of the pg library suggests using TIMESTAMPTZ[ here](https://node-postgres.com/features/types#date--timestamp--timestamptz).

More information on JavaScript applications needing timezone information[ here.](https://medium.com/@toastui/handling-time-zone-in-javascript-547e67aa842d)

### Edit Forms

For `created_at` data, which records the date, time and timezone of a row, we don't have any easy way to render that date data into an edit form \(although in real life you would probably never want to edit this information\).

If we did want to render an edit form for this data we would need to render a separate form for each piece, i.e, one input for data, another for time, another for timezone. The fundamental problem is that there is no such _**HTML**_ form which can properly set date and time together.

We'll get around this limitation of HTML forms later when we can do DOM manipulation again in the next module.

Note that there exists a datetime input type in HTML but that [it is not cross browser compatible.](https://caniuse.com/mdn-html_elements_input_input-datetime-local)

## Date Data

Given the above restriction on rendering and capturing date and time data, we can just decide to set our database table column data types to DATE type.

```sql
CREATE TABLE sightings (
    id            SERIAL PRIMARY KEY,
    description   TEXT,
    date          DATE, 
    created_at    TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

Note in the `sightings` example above we make the distinction between `created_at`, the date the row was created in the database, and `date`, the date of the UFO sighting.

### Date Forms

For dates \(not including time\) we can use the date type in a form. In the real world this would also not be an ideal case, since date forms are also not well supported \(about 90%\), but they are much more prevalent than datetime.

```markup
<input type="date" name="date"/>
```

Because the `date` type in the Postgres table we specified above matches the input format we specified in the input form, we can simply pass what's in `request.body.date` right into the database.

```javascript
app.post('/sightings', (request, response) => {

  const sightingValues = [request.body.description, request.body.date]; 

  const sightingInsertQuery = 'INSERT INTO sightings (description, date) VALUES ($1, $2) RETURNING *';

  pool.query(sightingInsertQuery, sightingValues, (error, result) => {
    
    if( error ){
      console.log(error);
      response.status(501).send('error!');
      return;
    }
    
    console.log( result.rows)
    response.send('worsk');
  });
});
```

See the [stats on date inputs here.](https://caniuse.com/mdn-html_elements_input_input-date)

### Date Output Format

The `pg` npm library is processing the data coming out of the database and transforming it into native JavaScript types. When we get the value of a DATE SQL type out of the database it's a [JavaScript Date object.](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)

We can call any of the methods on this value that are specified in the link above.

```javascript
app.get('/sightings', (request, response) => {

  const query = 'select * from sightings';
  
  pool.query(query).then(result => {
    
    // print out all the dates in the database
    const allSightingDates = result.rows.map(sighting => {
        console.log( sighting.date );
        
        // change this Date object into a string value
        return sighting.date.toString();
    });

    response.send( allSightingDates );
  })
});
```

### Advanced Date Formatting

If we want to format the date in some fancy way we can use a library:

```javascript
npm install moment
```

Add it to express:

```javascript
import moment from 'moment';
```

Use it as above:

```javascript
// ...

// print out all the dates in the database
const allSightingDates = result.rows.map(sighting => {
    console.log( sighting.date );
    
    // change this Date object into a string value
    // .from returns a "ago" string
    return moment(sighting.date).from();
});

// ...
```

The output will be something like this:

```javascript
["11 days ago","117 years ago"]
```

See the full docs on [how to output dates in the moment library here.](https://momentjs.com/docs/#/displaying/)

## Date + Time

If your app requires time data, it is probably most convenient to make a separate column for that data. In a real world situation, you would be imperative to include timezone data in this column, but in this module it's not recommended. We'll look at more advanced date time input methods with browser-side JavaScript in the next module.

