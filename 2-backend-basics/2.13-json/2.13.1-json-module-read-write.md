# 2.13.1: JSON Module - Read, Write

## Introduction

Now that we've learned what JSON is and how we can convert JSON to and from strings, let's start reading and writing JSON from files as databases for our apps.

Refer to lines 15, 18 and 21 to see where we process the JSON in the file.

### jsonFileStorage.js

```javascript
import { readFile, writeFile } from 'fs';

/**
 * Add a key-value pair to the JSON object in the relevant file
 * @param {string} filename - The name of the target JSON file
 * @param {string} key - The name of the key we wish to add
 * @param {*} value - The data that corresponds to the given key
 * @returns undefined
 */
export function add(filename, key, value) {

  const handleFileRead = (readErr, contentJson) => {
    if (readErr) {
      console.error('Reading error', readErr);
      return;
    }

    // Parse the JSON string from the file into a JS Object.
    const contentObj = JSON.parse(contentJson);

    // Add the new key and value to the content object.
    contentObj[key] = value;

    // Transform the updated content object back into a JSON string.
    const updatedContentJson = JSON.stringify(contentObj);

    // Write updated JSON to original file, overwriting original contents.
    writeFile(filename, updatedContentJson, (writeErr) => {
      if (writeErr) {
        console.error('Writing error', writeErr);
        return;
      }
      console.log('Success!');
    });
  };

  // Read the file called filename and call handleFileRead on its contents.
  readFile(filename, 'utf-8', handleFileRead);
}
```

The file, `data.json` begins empty, as an empty object, not an empty file.

If we leave out the curly braces the JSON.parse operation will fail.

```javascript
{
}
```

Use it like this:

```javascript
import { add } from 'jsonFileStorage';

// ...

add('data.json', 'name', 'kai');
```

`data.json` will look like this:

```javascript
{ "name": "kai" }
```

Note that if we used only write instead of read and then write, we would _overwrite_ everything in `data.json`.

## Read

### jsonFileStorage.js

```javascript
// ...

export function read(filename) {
  // set the file read callback
  const handleFileRead = (error, jsonContent) => {
    // check for reading errors
    if (error) {
      console.log('reading error', error);
    }

    console.log(jsonContent);
  };

  // read the file, and call handleFileRead callback after file is read.
  readFile(filename, 'utf-8', handleFileRead);
}
```

`data.json` looks like this:

```javascript
{"name":"kai"}
```

Use it like this:

```javascript
import { read } from 'jsonFileStorage';

// ...

read('data.json'); // will console.log {"name":"kai"}
```

## Write

### jsonFileStorage.js

```javascript
// ...

export function write(filename, content) {
  const stringContent = JSON.stringify(content);

  // set the file write callback
  const handleFileWrite = (error) => {
    // check for writing errors
    if (error) {
      console.log('writing error', error);
    }
  };

  // write the file, and call handleFileWrite callback when file is written.
  writeFile(filename, stringContent, handleFileWrite);
}
```

Use it like this:

```javascript
import { write } from 'jsonFileStorage';

// ...
const myData = { name: 'kai' };

write('data.json', myData);
```

`data.json` will look like this:

```javascript
{ "name": "kai" }
```

Remember that for a write-only operation, any data that was previously in data.json will disappear.

