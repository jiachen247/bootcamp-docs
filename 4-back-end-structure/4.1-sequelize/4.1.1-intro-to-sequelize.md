# 4.1.1: Intro to Sequelize

Let's setup our app:

```text
npm init
```

```text
npm install pg sequelize
npm install --save-dev sequelize-cli
```

Create the empty folders:

```text
mkdir config migrations models seeders
```

Create a config file:

## config/config.js

```javascript
module.exports = {
  development: {
    username: '<YOUR_USER_NAME>',
    password: null,
    database: 'grocery_development',
    host: '127.0.0.1',
    dialect: 'postgres',
  },
};
```

## Create the database:

```text
npx sequelize-cli db:create
```

## Create the item table:

```text
npx sequelize-cli migration:generate --name create-item-table
```

Delete the entire contents of the file and write the table creation code:

## -create-item-table.js

```javascript
module.exports = {
  up: async (queryInterface, Sequelize) => {
    await queryInterface.createTable('items', {
      id: {
        allowNull: false,
        autoIncrement: true,
        primaryKey: true,
        type: Sequelize.INTEGER,
      },
      name: {
        type: Sequelize.STRING,
      },
      createdAt: {
        allowNull: false,
        type: Sequelize.DATE,
      },
      updatedAt: {
        allowNull: false,
        type: Sequelize.DATE,
      },

    });
  },

  down: async (queryInterface, Sequelize) => {
    await queryInterface.dropTable('items');
  },
};
```

## Create the table

```text
npx sequelize-cli db:migrate
```

Check it in psql:

```text
psql -d grocery_development
```

## Create a single model file:

## models/item.mjs

```javascript
export default function itemModel(sequelize, DataTypes) {
  return sequelize.define('Item', {
    id: {
      allowNull: false,
      autoIncrement: true,
      primaryKey: true,
      type: DataTypes.INTEGER,
    },
    name: {
      type: DataTypes.STRING,
    },
    createdAt: {
      allowNull: false,
      type: DataTypes.DATE,
    },
    updatedAt: {
      allowNull: false,
      type: DataTypes.DATE,
    },
  });
}
```

## models/index.mjs

```javascript
import { Sequelize } from 'sequelize';
import allConfig from '../config/config.js';

import itemModel from './item.mjs';

const env = process.env.NODE_ENV || 'development';

const config = allConfig[env];

const db = {};

let sequelize = new Sequelize(config.database, config.username, config.password, config);

db.Item = itemModel(sequelize, Sequelize.DataTypes);

db.sequelize = sequelize;
db.Sequelize = Sequelize;

export default db;
```

## index.mjs

```javascript
import db from './models/index.mjs';

db.Item
  .create({
    name: process.argv[2],
  })
  .then((user) => {
    console.log('success!');
    console.log(user);
  })
  .catch((error) => console.log(error));
```

Run it:

```text
node index.js milk
```

Check the database:

```text
psql -d grocery_development
```

```text
SELECT * FROM items;
```

