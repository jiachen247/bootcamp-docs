# 1.5: High Card DOM

## Introduction

Many of us will have seen High Card from Coding Basics. For a refresher on High Card, see the Coding Basics page [here](https://basics.rocketacademy.co/10-javascript-objects/10-1-objects#high-card). In this module we will implement High Card from scratch, adding DOM elements to make the game more visual and interactive.

## Basic High Card

The following is a wireframe of our High Card UI. Game info will be in a big box on top, and there will be 2 buttons below for player 1 and 2 to draw cards respectively. 

![](../.gitbook/assets/bootcamp_-_wireframes_-_basic_dice_g%20%281%29%20%281%29%20%281%29.png)

The following is an adaptation of our [code from Coding Basics](https://basics.rocketacademy.co/10-javascript-objects/10.1-javascript-objects#high-card), where we add UI elements with DOM manipulation and event listeners to trigger game logic and UI updates based on user actions. The logic of this first version of High Card is the same as the original, non-DOM game.

```javascript
// Get a random index ranging from 0 (inclusive) to max (exclusive).
const getRandomIndex = (max) => Math.floor(Math.random() * max);

// Shuffle an array of cards
const shuffleCards = (cards) => {
  // Loop over the card deck array once
  for (let currentIndex = 0; currentIndex < cards.length; currentIndex += 1) {
    // Select a random index in the deck
    const randomIndex = getRandomIndex(cards.length);
    // Select the card that corresponds to randomIndex
    const randomCard = cards[randomIndex];
    // Select the card that corresponds to currentIndex
    const currentCard = cards[currentIndex];
    // Swap positions of randomCard and currentCard in the deck
    cards[currentIndex] = randomCard;
    cards[randomIndex] = currentCard;
  }
  // Return the shuffled deck
  return cards;
};

const makeDeck = () => {
  // Initialise an empty deck array
  const newDeck = [];
  // Initialise an array of the 4 suits in our deck. We will loop over this array.
  const suits = ['hearts', 'diamonds', 'clubs', 'spades'];

  // Loop over the suits array
  for (let suitIndex = 0; suitIndex < suits.length; suitIndex += 1) {
    // Store the current suit in a variable
    const currentSuit = suits[suitIndex];

    // Loop from 1 to 13 to create all cards for a given suit
    // Notice rankCounter starts at 1 and not 0, and ends at 13 and not 12.
    // This is an example of a loop without an array.
    for (let rankCounter = 1; rankCounter <= 13; rankCounter += 1) {
      // By default, the card name is the same as rankCounter
      let cardName = `${rankCounter}`;

      // If rank is 1, 11, 12, or 13, set cardName to the ace or face card's name
      if (cardName === '1') {
        cardName = 'ace';
      } else if (cardName === '11') {
        cardName = 'jack';
      } else if (cardName === '12') {
        cardName = 'queen';
      } else if (cardName === '13') {
        cardName = 'king';
      }

      // Create a new card with the current name, suit, and rank
      const card = {
        name: cardName,
        suit: currentSuit,
        rank: rankCounter,
      };

      // Add the new card to the deck
      newDeck.push(card);
    }
  }

  // Return the completed card deck
  return newDeck;
};

const deck = shuffleCards(makeDeck());

// Player 1 starts first
let playersTurn = 1;

// Use let for player1Card object because player1Card will be reassigned
let player1Card;

// create two buttons
const player1Button = document.createElement('button');
player1Button.innerText = 'Player 1 Draw';
document.body.appendChild(player1Button);

const player2Button = document.createElement('button');
player2Button.innerText = 'Player 2 Draw';
document.body.appendChild(player2Button);

// Create game info div as global value
// fill game info div with starting instructions
const gameInfo = document.createElement('div');
gameInfo.innerText = 'Its player 1 turn. Click to draw a card!';
document.body.appendChild(gameInfo);

// Create a helper function for output to abstract complexity
// of DOM manipulation away from game logic
const output = (message) => {
  gameInfo.innerText = message;
};

// Add an event listener on player 1's button to draw card and switch
// to player 2's turn
player1Button.addEventListener('click', () => {
  if (playersTurn === 1) {
    player1Card = deck.pop();
    playersTurn = 2;
  }
});

// Add event listener on player 2's button to draw card and determine winner
// Switch back to player 1's turn to repeat game
player2Button.addEventListener('click', () => {
  if (playersTurn === 2) {
    const player2Card = deck.pop();
    playersTurn = 1;

    if (player1Card.rank > player2Card.rank) {
      output('player 1 wins');
    } else if (player1Card.rank < player2Card.rank) {
      output('player 2 wins');
    } else {
      output('tie');
    }
  }
});
```

## Refactoring

The above is a lot of code, so we can organise it into sections \(soon we'll learn how to split up sections into multiple files\) within our JS file.

### Global Setup

Global variables that store game-wide data or DOM elements

```javascript
const deck = shuffleCards(makeDeck());

let playersTurn = 1; // matches with starting instructions
let player1Card;

const player1Button = document.createElement('button');

const player2Button = document.createElement('button');

const gameInfo = document.createElement('div');
```

### Helper Functions

Helper functions for game logic

```javascript
// Get a random index ranging from 0 (inclusive) to max (exclusive).
const getRandomIndex = (max) => Math.floor(Math.random() * max);

// Shuffle an array of cards
const shuffleCards = (cards) => {
  // Loop over the card deck array once
  for (let currentIndex = 0; currentIndex < cards.length; currentIndex += 1) {
    // Select a random index in the deck
    const randomIndex = getRandomIndex(cards.length);
    // Select the card that corresponds to randomIndex
    const randomCard = cards[randomIndex];
    // Select the card that corresponds to currentIndex
    const currentCard = cards[currentIndex];
    // Swap positions of randomCard and currentCard in the deck
    cards[currentIndex] = randomCard;
    cards[randomIndex] = currentCard;
  }
  // Return the shuffled deck
  return cards;
};

const makeDeck = () => {
  // Initialise an empty deck array
  const newDeck = [];
  // Initialise an array of the 4 suits in our deck. We will loop over this array.
  const suits = ['hearts', 'diamonds', 'clubs', 'spades'];

  // Loop over the suits array
  for (let suitIndex = 0; suitIndex < suits.length; suitIndex += 1) {
    // Store the current suit in a variable
    const currentSuit = suits[suitIndex];

    // Loop from 1 to 13 to create all cards for a given suit
    // Notice rankCounter starts at 1 and not 0, and ends at 13 and not 12.
    // This is an example of a loop without an array.
    for (let rankCounter = 1; rankCounter <= 13; rankCounter += 1) {
      // By default, the card name is the same as rankCounter
      let cardName = `${rankCounter}`;

      // If rank is 1, 11, 12, or 13, set cardName to the ace or face card's name
      if (cardName === '1') {
        cardName = 'ace';
      } else if (cardName === '11') {
        cardName = 'jack';
      } else if (cardName === '12') {
        cardName = 'queen';
      } else if (cardName === '13') {
        cardName = 'king';
      }

      // Create a new card with the current name, suit, and rank
      const card = {
        name: cardName,
        suit: currentSuit,
        rank: rankCounter,
      };

      // Add the new card to the deck
      newDeck.push(card);
    }
  }

  // Return the completed card deck
  return newDeck;
};

// Create a helper function for output to abstract complexity
// of DOM manipulation away from game logic
const output = (message) => {
  gameInfo.innerText = message;
};
```

### Player Action Callbacks

Callbacks that get triggered when player 1 and 2 click on their respective buttons.

```javascript
const player1Click = () => {
  if (playersTurn === 1) {
    player1Card = deck.pop();
    playersTurn = 2;
  }
};

const player2Click = () => {
  if (playersTurn === 2) {
    const player2Card = deck.pop();
    playersTurn = 1;

    if (player1Card.rank > player2Card.rank) {
      output('player 1 wins');
    } else if (player1Card.rank < player2Card.rank) {
      output('player 2 wins');
    } else {
      output('tie');
    }
  }
};
```

### Game Initialisation

We can now centralise our game initialisation into a single function called `initGame`.

```javascript
const initGame = () => {
  // initialize button functionality
  player1Button.innerText = 'Player 1 Draw';
  document.body.appendChild(player1Button);

  player2Button.innerText = 'Player 2 Draw';
  document.body.appendChild(player2Button);

  player1Button.addEventListener('click', player1Click);
  player2Button.addEventListener('click', player2Click);

  // fill game info div with starting instructions
  gameInfo.innerText = 'Its player 1 turn. Click to draw a card!';
  document.body.appendChild(gameInfo);
};
```

## High Card Output

Now let's display elements within the Game Info box we planned for at the start. This will require more complex DOM manipulation because it involves nested elements, e.g. cards within the game info box, various properties within each card.

![](../.gitbook/assets/bootcamp_-_wireframes_-_basic_high_c%20%281%29%20%281%29%20%281%29%20%281%29.png)

When creating visual DOM element output with JS we'll use the following strategies to help us.

1. Hard-code HTML first to determine what structure we need, before coding JS for those elements
2. Apply CSS styles with CSS classes defined in a separate CSS file, and avoid applying CSS styles to DOM elements inline. This helps us keep our CSS organised and manageable.
3. Try to keep game logic as simple as possible by creating helper functions for creation or manipulation of each DOM element. This allows us to separate more "operational code" \(creating elements, adding elements to the DOM, adding CSS classes to elements\) from the higher-level logic \(e.g. `createGameInfoBox`, `createPlayerButton`, `createCard`, `revealCard`\). Try to avoid mixing DOM manipulation code with higher-level logic.

This might be the HTML we want for a single card:

```markup
<div class="card">
  <div class="name red">3</div>
  <div class="suit">♥️</div>
</div>
```

The CSS for these elements might look like this:

```css
.card {
  margin: 10px;
  padding: 10px;
  background-color: grey;
  width: 50px;
  text-align: center;
  border-radius: 8px;
  display: inline-block;
}

.suit {
  margin: 5px;
  font-size: 20px;
}

.name {
  margin: 5px;
  font-size: 24px;
  font-weight: bold;
  font-family: sans-serif;
}

.red {
  color: red;
}
```

We should be able to test this code in the HTML file.

![](../.gitbook/assets/screen-shot-2020-10-08-at-2.40.35-pm-2-.png)

For the sake of convenience we also want to make a place for our JavaScript to put these cards within the game:

```markup
<div class="card-container">
    <div class="card">
        <div class="name red">3</div>
        <div class="suit">♥️</div>
    </div>
    <div class="card">
        <div class="name red">4</div>
        <div class="suit">♥️</div>
    </div>
</div>
```

The JavaScript to build the card element might look like this:

```javascript
const suit = document.createElement('div');
suit.classList.add('suit');
suit.innerText = '♥️';

const name = document.createElement('div');
name.classList.add('name', 'red');
name.innerText = '3';

const card = document.createElement('div');
card.classList.add('card');

card.appendChild(name);
card.appendChild(suit);
```

We want to extract this out into a function so that we can use it to create the elements for any card.

We also added the card colour in the example. In order to get this behaviour for every card we could have implemented some logic:

```javascript
// if the suit is heart or diamond
// the color is red
```

But it would be a bit easier to encode this into the data of the card itself.

If we want to add other stylistic features we could also decide to change the name of the card.

That is, in our example card layout above there is not room for a full name face card, like `queen` . We can add another attribute to the object:

```javascript
const cardInfo = {
  suitSymbol: '♦️',
  suit: 'diamond',
  name: 'queen',
  display: 'Q',
  color: 'red',
  rank: 12,
};
```

Now we can use the attributes in the `createCard` function:

```javascript
const createCard = (cardInfo) => {
  const suit = document.createElement('div');
  suit.classList.add('suit');
  suit.innerText = cardInfo.suitSymbol;

  const name = document.createElement('div');
  name.classList.add(cardInfo.display, cardInfo.color);
  name.innerText = '3';

  const card = document.createElement('div');
  card.classList.add('card');

  card.appendChild(name);
  card.appendChild(suit);

  return card;
};
```

{% hint style="info" %}
We can go back and hard-code all of these attributes into a deck array. But how would we alter the logic of `createDeck` to account for these other attributes?
{% endhint %}

### Putting it all together

Add the `cardContainer` DOM element global variable to the globals:

```javascript
let cardContainer;
```

Add the `card-container` div to the `initGame` function:

```javascript
cardContainer = document.createElement('div');
cardContainer.classList.add('card-container');
document.body.appendChild(cardContainer);
```

Let's take a look at the button callback functions:

```javascript
const player1Click = () => {
  if (playersTurn === 1) {
    player1Card = deck.pop();

    const cardElement = createCard(player1Card);

    // in case this is not the 1st time
    // in the entire app,
    // empty the card container
    cardContainer.innerHTML = '';

    cardContainer.appendChild(cardElement);

    playersTurn = 2;
  }
};

const player2Click = () => {
  if (playersTurn === 2) {
    const player2Card = deck.pop();
    cardContainer.appendChild(cardElement);

    playersTurn = 1;

    if (player1Card.rank > player2Card.rank) {
      output('player 1 wins');
    } else if (player1Card.rank < player2Card.rank) {
      output('player 2 wins');
    } else {
      output('tie');
    }
  }
};

const cardOutput = (message) => {
  gameInfo.innerText = message;
};
```

## Exercise

Fork and clone the [Coding Bootcamp High Card repo](https://github.com/rocketacademy/high-card-bootcamp) and use code from High Card above to construct a working High Card game.

